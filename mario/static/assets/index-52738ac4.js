var Ae=Object.defineProperty;var _e=(n,t,r)=>t in n?Ae(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var _=(n,t,r)=>(_e(n,typeof t!="symbol"?t+"":t,r),r);import{j as z,r as g,u as fe,a as Fe,F as Me,b as qe,c as je,d as Ue,e as Ke,f as Ve,g as We,h as Xe,P as Be,D as Qe,i as Ge,k as He,A as C,I as w,l as Y,m as ze,n as N,o as Ye,U as v,p as L,q as ye,s as ve,t as m,v as U,_ as Je,w as xe,X as J,Z,x as O,y as P,G as ee,Q as S,R as te,L as I,C as Ze,z as et,N as be,K as tt,B as nt,E as rt,S as st,H as it,J as at,M as ot,O as we,T as Ne,V as ne,W as re,Y as ct,$ as lt,a0 as se,a1 as $,a2 as Ce,a3 as k,a4 as M,a5 as Re,a6 as de,a7 as dt,a8 as ue,a9 as he,aa as ut,ab as ht,ac as mt,ad as pt,ae as gt,af as ft,ag as yt,ah as vt,ai as xt,aj as bt}from"./vendor-3de3ab70.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const T=z.Fragment,e=z.jsx,i=z.jsxs;class wt extends Error{constructor(r,o){const s=r.status||r.status===0?r.status:"",a=r.statusText||"",c=`${s} ${a}`.trim(),d=c?`status code ${c}`:"an unknown error";super(`Request failed with ${d}`);_(this,"response");_(this,"request");this.name="HTTPError",this.response=r,this.request=o}}const Nt=n=>{const t=new URLSearchParams;return Object.entries(n).forEach(([r,o])=>{o!==void 0&&t.set(r,o)}),t};class Ct{constructor(t={}){_(this,"config");var r;this.config=t,this.config.baseUrl=(r=this.config.baseUrl)==null?void 0:r.replace(/\/+$/,"")}get baseUrl(){return this.config.baseUrl}async fetch(t){let r,o;if(typeof t=="string")r=t;else{const{url:c,params:d,json:u,...h}=t;if(r=c,o=h,u&&(o.body=JSON.stringify(u),o.headers={"Content-Type":"application/json"}),d){const f=Nt(d);r+=`?${f}`}}this.config.baseUrl&&(r=this.config.baseUrl+r);const s=new Request(r,{...o,credentials:"include"}),a=await fetch(s);if(!a.ok)throw new wt(a,s);return a.headers.get("Content-Type")==="application/json"?await a.json():await a.text()}async fetchForceMethod(t,r){return typeof t=="string"?this.fetch({url:t,method:r}):this.fetch({...t,method:r})}async get(t){return this.fetchForceMethod(t,"get")}async post(t){return this.fetchForceMethod(t,"post")}async put(t){return this.fetchForceMethod(t,"put")}async patch(t){return this.fetchForceMethod(t,"patch")}async delete(t){return this.fetchForceMethod(t,"delete")}}const Rt=`${window.location.protocol}//${window.location.host}/api`,K={}.VITE_API_BASE_URL||Rt,R=new Ct({baseUrl:K}),Pt=()=>R.baseUrl,St=async()=>await R.get("/whoami"),Tt=async()=>{await R.post("/logout")},ie=()=>{const n=new URL(K);return n.protocol="ws",n.pathname+="/ws",n},Lt=async()=>await R.get("/pipelines"),ae=async n=>await R.get(`/pipelines/${n}`),kt=async n=>await R.get(`/pipelines/${n}/input-schema`),Pe=async(n,t)=>{const r={pipeline_id:n,trigger_id:t},o=await R.get({url:"/runs",params:r});return o.forEach(s=>{s.start_time=new Date(s.start_time)}),o},Ot=async n=>{const t=await R.get(`/runs/${n}`);return t.start_time=new Date(t.start_time),t},Dt=async n=>(await R.get(`/runs/${n}/logs`)).split(`
`).map((r,o)=>{const s=JSON.parse(r);return s.id=o,s.timestamp=new Date(s.timestamp),s}),Et=async(n,t)=>await R.get(`/runs/${n}/data/${t}`),Q=n=>`${K}/pipelines/${n}/run`,It=n=>({async mutationFn(t){R.post({url:`/pipelines/${n}/run`,json:t})}}),F=(n,t,r=!0)=>`${r?K:""}/pipelines/${n}/triggers/${t}/run`,$t=async(n,t)=>await R.post(F(n,t,!1)),Se=g.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),At=(n,t)=>{switch(t.type){case"LOGIN":return{...n,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...n,isAuthenticated:!1,user:null};case"POPULATE":return{...n,user:t.payload?{...n.user,...t.payload}:null};case"STOP_LOADING":return{...n,isLoading:!1};default:throw new Error("Unknown action type")}},_t=({children:n})=>{const[t,r]=g.useReducer(At,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await Tt(),r({type:"LOGOUT"})},user:null});return g.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:s,user:a}=await St();(s&&a||!s)&&r({type:"LOGIN",payload:{user:a,isAuthenticationEnabled:s}})}catch(s){console.error(s)}finally{r({type:"STOP_LOADING"})}})()},[]),e(Se.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":n})},oe=()=>g.useContext(Se),Ft=n=>`translate${n==="bottom"||n==="top"?"Y":"X"}(${n==="bottom"||n==="right"?"-":"+"}10%)`;function Mt({initialOpen:n=!1,placement:t="bottom",modal:r,open:o,onOpenChange:s}={}){const[a,c]=g.useState(n),[d,u]=g.useState(),[h,f]=g.useState(),l=o??a,y=s??c,b=Ue({placement:t,open:l,onOpenChange:y,whileElementsMounted:Be,middleware:[Qe(5),Ge({fallbackAxisSideDirection:"end"}),He({padding:5})]}),p=b.context,x=Ke(p,{enabled:o==null}),D=Ve(p),B=We(p),A=Xe([x,D,B]);return g.useMemo(()=>({open:l,setOpen:y,...A,...b,modal:r,labelId:d,descriptionId:h,setLabelId:u,setDescriptionId:f}),[l,y,A,b,r,d,h])}const Te=g.createContext(null),V=()=>{const n=g.useContext(Te);if(n==null)throw new Error("Popover components must be wrapped in <Popover />");return n};function qt({children:n,modal:t=!0,...r}){const o=Mt({modal:t,...r});return e(Te.Provider,{value:o,children:n})}const jt=g.forwardRef(function({children:t,asChild:r=!1,...o},s){const a=V(),c=t.ref,d=fe([a.refs.setReference,s,c]);return r&&g.isValidElement(t)?g.cloneElement(t,a.getReferenceProps({ref:d,...o,...t.props,"data-state":a.open?"open":"closed"})):e("button",{ref:d,type:"button","data-state":a.open?"open":"closed",...a.getReferenceProps(o),children:t})}),Ut=g.forwardRef(function(t,r){const{context:o,...s}=V(),a=fe([s.refs.setFloating,r]),{isMounted:c,styles:d}=Fe(o,{initial:({side:u})=>({opacity:0,transform:Ft(u)})});return e(Me,{children:c&&e(qe,{context:o,modal:s.modal,children:e("div",{ref:a,style:{position:s.strategy,top:s.y??0,left:s.x??0,width:"max-content",...t.style,...d},"aria-labelledby":s.labelId,"aria-describedby":s.descriptionId,...s.getFloatingProps(t),children:t.children})})})});g.forwardRef(function({children:t,...r},o){const{setDescriptionId:s}=V(),a=je();return g.useLayoutEffect(()=>(s(a),()=>s(void 0)),[a,s]),e("p",{...r,ref:o,id:a,children:t})});g.forwardRef(function(t,r){const{setOpen:o}=V();return e("button",{type:"button",ref:r,...t,onClick:s=>{var a;(a=t.onClick)==null||a.call(t,s),o(!1)}})});const Kt=()=>{const{logout:n,user:t}=oe();if(!t)return e("div",{children:"Not logged in"});const r=t.name.split(" "),o=r.length>1?`${r.at(0)[0]}${r.at(-1)[0]}`:r[0];return i(qt,{placement:"bottom-start",children:[e(jt,{children:e("div",{className:"flex justify-center items-center font-medium bg-white ring-1 ring-slate-200 text-indigo-500 rounded-full ml-4 hover:ring-2 transition-shadow",style:{width:34,height:34},children:o})}),e(Ut,{children:i(C,{className:"shadow-xl",children:[e(w,{children:t.name}),e(Y,{children:t.email}),e(ze,{}),e(N,{size:"xs",variant:"secondary",color:"rose",icon:Ye,className:"w-full",onClick:async()=>await n(),children:"Logout"})]})})]})},W=({children:n,header:t})=>{const{isAuthenticated:r,isAuthenticationEnabled:o}=oe();return i("div",{className:"bg-slate-50 p-6 sm:p-10 min-h-screen",children:[i(v,{className:"items-start",children:[t&&e("div",{className:"flex-grow",children:t}),r&&o&&e(Kt,{})]}),e("main",{children:n})]})},X=({children:n,footer:t,isOpen:r,maxHeight:o,maxWidth:s="600px",minWidth:a="350px",subtitle:c,title:d,onClose:u})=>{const h=g.createRef();return g.useEffect(()=>{var l,y;r?(l=h.current)==null||l.showModal():(y=h.current)==null||y.close()},[r]),e("dialog",{ref:h,style:{padding:0,background:"transparent",overflow:"visible",maxHeight:o,maxWidth:s,minWidth:a},onClick:l=>{var p;var y=h.current.getBoundingClientRect(),b=y.top<=l.clientY&&l.clientY<=y.top+y.height&&y.left<=l.clientX&&l.clientX<=y.left+y.width;b||(u?u():(p=h.current)==null||p.close())},children:i(C,{children:[d&&e(w,{children:d}),c&&e(Y,{children:c}),e("div",{className:(d||c)&&"mt-6",children:n}),t&&e(v,{className:"justify-end space-x-6 mt-6",children:t})]})})},Vt=n=>{const t=s=>{if(!n.definitions)return;const a=s.split("/").pop();return n.definitions[a]},r=n.properties;if(!r)return e(m,{className:"mt-4",children:"This pipeline has no input"});const o=Object.entries(r).map(([s,a])=>{var l,y,b;if(typeof a=="boolean")return;let c=a,d;if(a.allOf){const p=a.allOf[0];if(d=(l=a.default)==null?void 0:l.toString(),p.$ref){const x=t(p.$ref);x&&(c=x)}}else if(a.$ref){const p=t(a.$ref);p&&(c=p)}else d=(y=c.default)==null?void 0:y.toString();const u=c.title||s,h=(c.enum?"enum":Array.isArray(c.type)?c.type[0]:c.type)||"string",f=(b=n.required)==null?void 0:b.includes(s);if(["number","integer"].includes(h)){const p=c.minimum||c.exclusiveMinimum,x=c.maximum||c.exclusiveMaximum;if(p!==void 0&&x!==void 0){const D=g.createRef(),B=h==="number"?(x-p)/10:1;return i("div",{children:[e(m,{children:u}),e("input",{name:s,type:"range",min:p,max:x,step:B,defaultValue:d,required:f,onInput:A=>D.current&&(D.current.value=A.target.value),className:"w-full mt-2 cursor-ew-resize appearance-none h-2 bg-slate-200 border border-slate-400 rounded"}),i(v,{className:"items-baseline space-x-4",children:[i("div",{className:"ml-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:p})]}),e(m,{children:e(U,{children:e("output",{ref:D,className:"px-2 py-1 rounded bg-slate-200 block truncate text-center",children:d})})}),i("div",{className:"mr-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:x})]})]})]},s)}else return i("div",{children:[e(m,{children:u}),e("input",{name:s,type:"number",min:p,max:x,defaultValue:d,className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium invalid:border-rose-500 mt-2",style:{textAlign:"end",width:"100%"},required:f})]},s)}else return h==="enum"?i("div",{children:[e(m,{children:u}),i("select",{name:s,defaultValue:d||"",className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium w-full invalid:border-rose-500 mt-2",required:f,children:[e("option",{disabled:!0,value:"",children:"Select..."}),c.enum.map(p=>e("option",{value:p.toString(),children:p==null?void 0:p.toString()},p==null?void 0:p.toString()))]})]},s):i("div",{children:[i(m,{children:[u," ",f&&"*"]}),e(Je,{name:s,placeholder:u,defaultValue:d,className:"mt-2"})]},s)});return e("div",{className:"space-y-4",children:o})},ce=({pipeline:n})=>{const[t,r]=g.useState(!1),o=L({queryKey:["pipeline-input",n.id],queryFn:()=>kt(n.id),enabled:t}),s=ye(It(n.id));return i(T,{children:[e(N,{color:"indigo",variant:"secondary",size:"xs",icon:ve,onClick:()=>r(!0),children:"Run pipeline"}),e(X,{isOpen:t,title:`Run ${n.name} manually`,onClose:()=>r(!1),children:i("form",{method:"dialog",onSubmit:a=>{const c=Object.fromEntries(new FormData(a.target).entries());s.mutateAsync(c)},children:[o.isLoading?"Loading...":e("div",{style:{width:350},children:Vt(o.data)}),i(v,{className:"justify-end space-x-6 mt-6",children:[e(N,{variant:"secondary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),e(N,{color:"indigo",type:"submit",children:"Run"})]})]})})]})},Le=({pipeline:n})=>{const t=xe();return i(C,{className:"mt-5",children:[e(w,{children:"Triggers"}),i(J,{children:[e(Z,{children:i(O,{children:[e(P,{children:"Name"}),e(P,{children:"Interval"})]})}),e(ee,{children:n.triggers.map(r=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>t(`/pipelines/${n.id}/triggers/${r.id}`),children:[e(S,{children:r.name}),e(S,{children:e(m,{children:r.aps_trigger})})]},r.id))})]})]})},Wt=()=>{const n=L({queryKey:["pipelines"],queryFn:Lt,initialData:[]});if(n.isLoading)return e("div",{children:"Loading..."});if(n.error)return e("div",{children:"An error has occurred"});const t=n.data;return e(T,{children:t.map(r=>i(te.Fragment,{children:[i(v,{children:[e(v,{children:i(v,{className:"justify-start items-baseline space-x-2",children:[e(w,{children:e(I,{to:`/pipelines/${r.id}`,children:r.name})}),e(m,{className:"truncate max-w-lg",children:r.description})]})}),e(ce,{pipeline:r})]}),e(Le,{pipeline:r})]},r.id))})};function Xt(){return e(W,{header:i(T,{children:[e(w,{children:"Mario Pype"}),e(m,{children:"All your pipelines."})]}),children:e("div",{className:"mt-6",children:e(Wt,{})})})}const Bt=()=>e("div",{className:"h-screen flex justify-center items-center bg-slate-200",children:i(C,{className:"w-auto",children:[e("div",{className:"w-12 rounded-full mx-auto mb-4",children:e("img",{src:"/mario-pipe-flower.png",alt:"Mario Pype logo"})}),e(w,{className:"mb-6",children:"Welcome to Mario Pype"}),e(N,{onClick:()=>{location.href=`${Pt()}/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),ke=({content:n})=>{const[t,r]=g.useState(!1),o=g.useRef();return e(N,{variant:"light",color:"indigo",size:"sm",icon:t?Ze:et,onClick:()=>{navigator.clipboard.writeText(n),r(!0),o.current=setTimeout(()=>r(!1),3e3)}})},E=()=>e(m,{children:"/"}),le=({pipeline:n,trigger:t,run:r})=>{if(r&&!t)throw new Error;return e("div",{className:"breadcrumbs",children:i(v,{className:"space-x-2 justify-start",children:[e(m,{children:e(I,{to:"/",children:"Pipelines"})}),e(E,{}),e(m,{children:t?e(I,{to:`/pipelines/${n.id}`,children:n.name}):n.name}),t&&i(T,{children:[e(E,{}),e(m,{children:"Triggers"}),e(E,{}),e(m,{children:r?e(I,{to:`/pipelines/${n.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&i(T,{children:[e(E,{}),e(m,{children:"Runs"}),e(E,{}),i(m,{children:["#",r.id]})]})]})})},me=n=>(n/1e3).toFixed(1)+" s",Oe=({runs:n})=>{const t=n.filter(o=>o.status==="completed").reverse(),r=t.reduce((o,s)=>o+s.duration,0)/t.length||0;return i(C,{children:[e(v,{className:"items-start",children:e(m,{children:"Duration"})}),e(v,{className:"justify-start items-baseline space-x-3 truncate",children:e(be,{children:me(r)})}),e(tt,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:me,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},q={completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",notrun:"slate",warning:"amber"},G={completed:nt,failed:rt,cancelled:st,running:it,notrun:at,warning:ot},H=["cyan","violet","pink","emerald","orange","stone","fuchsia"],De=n=>Object.fromEntries(n.map((t,r)=>[t.id,`bg-${H[r%H.length]}-500`])),Qt=n=>we(n).format("D MMM YYYY HH:mm:ss (Z[Z])"),Gt=n=>we(n).format("HH:mm:ss.SSS"),Ee=({status:n})=>e(Ne,{color:q[n],icon:G[n],children:n}),Ht=({startTime:n})=>{const[t,r]=g.useState(Date.now()-n.getTime());return g.useEffect(()=>{const o=setInterval(()=>{r(Date.now()-n.getTime())},500);return()=>{clearInterval(o)}}),e("span",{children:(t/1e3).toFixed(2)})},Ie=({pipelineId:n,runs:t,triggerId:r})=>{const[o,s]=g.useState(t),a=ne(),c=xe(),{lastJsonMessage:d}=re(ie().toString()),u=g.useCallback(h=>{const{data:f,type:l}=h;if(l==="run-update")if(f.run.start_time=new Date(f.run.start_time),f.run.trigger_id=f.trigger,f.run.status==="running")s([f.run,...o]);else{let y=[...o];const b=y.findIndex(p=>p.id===f.run.id);b>=0?y[b]=f.run:y=[f.run,...y],s(y),a.invalidateQueries({queryKey:["runs",n,r]})}},[n,a,o,r]);return g.useEffect(()=>{d&&u(d)},[d]),g.useEffect(()=>{t.length&&s(t)},[t]),i(C,{className:"mt-5",children:[e(w,{children:"Runs"}),i(J,{children:[e(Z,{children:i(O,{children:[e(P,{className:"text-right",children:"#"}),e(P,{children:"Status"}),!r&&e(P,{children:"Trigger"}),e(P,{children:"Started at"}),e(P,{className:"text-right",children:"Duration"})]})}),e(ee,{children:o.map(h=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>c(`/pipelines/${n}/triggers/${h.trigger_id}/runs/${h.id}`),children:[e(S,{className:"text-right",children:h.id}),e(S,{children:e(Ee,{status:h.status})}),!r&&e(S,{children:e(I,{to:`/pipelines/${n}/triggers/${h.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:f=>f.stopPropagation(),children:h.trigger_id})}),e(S,{children:e(m,{children:Qt(h.start_time)})}),i(S,{className:"text-right",children:[h.status!=="running"?(h.duration/1e3).toFixed(2):e(Ht,{startTime:h.start_time})," ","s"]})]},h.id))})]})]})},$e=({runs:n,subject:t})=>{var c,d;const o=n.filter(u=>u.status==="completed").length/n.length*100||0,s=(c=n[0])==null?void 0:c.start_time,a=(d=n[n.length-1])==null?void 0:d.start_time;return i(C,{children:[e(v,{children:i(w,{children:[t," health"]})}),n.length?i(T,{children:[i(v,{className:"mt-4",children:[e(m,{children:"Successful runs"}),i(m,{children:[o.toFixed(1)," %"]})]}),e(ct,{className:"mt-2",data:n.map(u=>({key:u.id,color:q[u.status],tooltip:`#${u.id} ${u.status}`}))})]}):e(m,{className:"text-center mt-8",children:i(lt,{children:["This ",t.toLowerCase()," has no runs yet"]})}),i(v,{className:"mt-2",children:[e(m,{children:s&&s.toDateString()}),e(m,{children:a&&a.toDateString()})]})]})},zt=()=>{const t=se().pipelineId,r=L({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),o=L({queryKey:["runs",t,void 0],queryFn:()=>Pe(t),initialData:[]});if(o.isLoading||r.isLoading)return e("div",{children:"Loading..."});if(o.error||r.error)return e("div",{children:"An error has occurred"});const s=r.data;return i(W,{header:i(v,{className:"items-start",children:[i("div",{children:[i(v,{className:"justify-start space-x-2",children:[i(w,{children:["Pipeline ",s.name]}),s.description&&i(m,{className:"truncate",children:["· ",s.description]})]}),e(le,{pipeline:s})]}),e(ce,{pipeline:s})]}),children:[i($,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:"Tasks"}),e(Ce,{children:s.tasks.map(a=>e(k,{children:i("div",{children:[e(m,{children:e(U,{children:a.name})}),a.description&&e(m,{className:"truncate",children:a.description})]})},a.id))}),e("div",{style:{flexGrow:1}}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(M,{size:"sm",color:"slate",icon:Re,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:Q(t),children:Q(t)}),e(ke,{content:Q(t)})]})]})]}),e($e,{subject:"Pipeline",runs:[...o.data].reverse()}),e(Oe,{runs:o.data})]}),i($,{numCols:1,numColsSm:1,numColsMd:1,numColsLg:2,className:"gap-6 mt-6",children:[e(de,{children:e(Le,{pipeline:s})}),e(de,{children:e(Ie,{runs:o.data,pipelineId:t})})]})]})},Yt=({trigger:n})=>{const[t,r]=g.useState(!1);return i(T,{children:[e(N,{color:"indigo",variant:"light",size:"sm",icon:dt,onClick:()=>r(!0),children:"Show params"}),e(X,{isOpen:t,title:"Trigger params",subtitle:n.name,footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e("pre",{className:"p-3 bg-slate-100 rounded-md",children:JSON.stringify(n.params,null,2)})})]})},j={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},Jt=()=>{const n=se(),t=n.pipelineId,r=n.triggerId,o=L({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),s=L({queryKey:["runs",t,r],queryFn:()=>Pe(t,r),initialData:[],enabled:!!r}),a=ye({mutationFn:()=>$t(t,r)});if(s.isLoading||o.isLoading)return e("div",{children:"Loading..."});if(s.error||o.error)return e("div",{children:"An error has occurred"});const c=o.data,d=r===j.id,u=d?j:c.triggers.find(f=>f.id===r);if(!u)return e("div",{children:"Trigger not found"});const h=d?e(ce,{pipeline:c}):e(N,{size:"xs",color:"indigo",icon:ve,onClick:()=>{a.mutateAsync()},children:"Run trigger"});return i(W,{header:i(v,{className:"items-start",children:[i("div",{children:[i(w,{children:["Trigger ",u.name]}),e(le,{pipeline:c,trigger:u})]}),h]}),children:[i($,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:u.name}),e(Y,{children:u.description}),e("div",{style:{flexGrow:1}}),i(k,{children:[e(m,{children:"Schedule"}),e(m,{children:e(U,{children:u.aps_trigger})})]}),i(k,{children:[e(m,{children:"Params"}),u.params?e(Yt,{trigger:u}):e(m,{children:e("em",{children:"No params"})})]}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(M,{size:"sm",color:"slate",icon:Re,tooltip:"URL to run the trigger programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:F(t,r),children:F(t,r)}),e(ke,{content:F(t,r)})]})]})]}),e($e,{subject:"Trigger",runs:[...s.data].reverse()}),e(Oe,{runs:s.data})]}),e("div",{className:"mt-6",children:e(Ie,{runs:s.data,pipelineId:t,triggerId:r})})]})},Zt=({logEntry:n})=>{const[t,r]=g.useState(!1);return i(v,{className:"mt-1",children:[e(N,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e(X,{isOpen:t,title:"Traceback info",footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),maxWidth:"80%",onClose:()=>r(!1),children:e("div",{className:"flex flex-col",children:e("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-slate-100 rounded-md whitespace-pre font-mono",children:n.exc_info})})})]})},pe={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},en=({pipeline:n,runId:t})=>{const[r,o]=g.useState({levels:[],tasks:[]}),{lastJsonMessage:s}=re(ie().toString()),a=ne(),c=L({queryKey:["logs",t],queryFn:()=>Dt(t),enabled:!!t,initialData:[]}),d=g.useCallback(l=>{const{data:y,type:b}=l;b==="logs"&&a.setQueryData(["logs",t],(p=[])=>{const x=JSON.parse(y);return x.id=p.length,x.timestamp=new Date(x.timestamp),[...p,x]})},[t]);g.useEffect(()=>{s&&d(s)},[s]);const u=g.useCallback(l=>{o(y=>({...y,...l}))},[]);if(c.isLoading)return e("div",{children:"Loading..."});if(c.isError)return e("div",{children:"Error loading logs"});const h=c.data.filter(l=>(r.levels.length===0||r.levels.includes(l.level))&&(r.tasks.length===0||r.tasks.includes(l.task))),f=De(n.tasks);return i(T,{children:[i($,{numColsMd:3,className:"gap-6",children:[i("div",{children:[e(m,{children:"Tasks"}),e(ue,{className:"mt-1",onValueChange:l=>{u({tasks:l})},children:n.tasks.map(l=>e(he,{text:l.name,value:l.id},l.id))})]}),i("div",{children:[e(m,{children:"Log level"}),e(ue,{className:"mt-1",onValueChange:l=>{u({levels:l})},children:Object.keys(pe).map(l=>e(he,{text:l,value:l},l))})]})]}),e("div",{className:"logs-table",children:i(J,{className:"mt-6",children:[e(Z,{children:i(O,{children:[e(P,{children:"Time"}),e(P,{children:"Level"}),e(P,{children:"Task"}),e(P,{children:"Message"})]})}),e(ee,{children:h.map((l,y)=>{const b=y!==0?l.timestamp.getTime()-h[y-1].timestamp.getTime():-1;return i(O,{children:[i(S,{children:[e("span",{className:"font-mono text-xs text-slate-500",children:Gt(l.timestamp)}),b>=0&&i("span",{className:"font-mono text-xs text-slate-500 ml-2",children:["+",b," ms"]})]}),e(S,{children:e(Ne,{size:"xs",color:pe[l.level],children:l.level})}),e(S,{children:i(v,{children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${f[l.task]}`}),l.task]})}),i(S,{children:[e(m,{children:l.message}),l.exc_info&&e(Zt,{logEntry:l})]})]},l.id)})})]})})]})},tn="modulepreload",nn=function(n){return"/"+n},ge={},rn=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(a=>{if(a=nn(a),a in ge)return;ge[a]=!0;const c=a.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(!!o)for(let f=s.length-1;f>=0;f--){const l=s[f];if(l.href===a&&(!c||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${d}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":tn,c||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),c)return new Promise((f,l)=>{h.addEventListener("load",f),h.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())},sn=te.lazy(()=>rn(()=>import("./HandsonTable-f86b714e.js"),["assets/HandsonTable-f86b714e.js","assets/vendor-3de3ab70.js","assets/HandsonTable-a8e02e84.css"])),an=({runId:n,taskId:t,open:r,onClose:o})=>{const s=L({queryKey:["getRunData",{runId:n,taskId:t}],queryFn:()=>Et(n,t),enabled:r});return e(T,{children:i(X,{title:t,subtitle:"View data",isOpen:r,maxWidth:"90%",minWidth:"90%",footer:e(N,{variant:"secondary",color:"indigo",onClick:()=>o(),children:"Close"}),onClose:o,children:[!s.isLoading&&!s.isError&&e(g.Suspense,{fallback:e("div",{children:"Loading..."}),children:e(sn,{data:s.data,rowHeaders:!0,colHeaders:Object.keys(s.data[0]),height:"70vh",width:"100%",licenseKey:"non-commercial-and-evaluation"})}),s.isError&&(s.error.response.status===404?e(m,{children:"The task has no data"}):i(m,{color:"rose",children:["Error fetching task data: ",s.error.message]}))]})})},on=({pipeline:n,run:t})=>{const[r,o]=g.useState(),s=De(n.tasks);return i(C,{children:[e(an,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>o(void 0)}),e(w,{children:"Tasks"}),e(Ce,{children:n.tasks.map((a,c)=>{var d;return i(k,{className:"space-x-4",children:[t.tasks_run[c]?e(M,{variant:"light",icon:G[t.tasks_run[c].status],color:q[t.tasks_run[c].status]}):e(M,{variant:"light",icon:G.notrun,color:q.notrun}),i("div",{className:"truncate flex-grow",children:[i(v,{className:"justify-start",children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${s[a.id]}`}),e(m,{className:"truncate",children:e(U,{children:a.name})})]}),a.description&&e(m,{className:"truncate",children:a.description})]}),((d=t.tasks_run[c])==null?void 0:d.has_output)&&e(N,{variant:"light",color:"indigo",size:"xs",icon:ut,onClick:()=>o(a.id),children:"Data"})]},a.id)})})]})},cn=()=>{const{lastJsonMessage:n}=re(ie().toString()),t=ne(),r=se(),o=r.pipelineId,s=r.triggerId,a=parseInt(r.runId);g.useEffect(()=>{if(n){const{data:p,type:x}=n;x==="run-update"&&t.invalidateQueries({queryKey:["run",o,s,a]}).catch(()=>{})}},[n,o]);const c=L({queryKey:["pipeline",o],queryFn:()=>ae(o),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!o}),d=L({queryKey:["run",o,s,a],queryFn:()=>Ot(a),enabled:!!(o&&s&&a)}),u=c.data,f=s===j.id?j:u.triggers.find(p=>p.id===s),l=d.data;if(!l)return e("div",{children:"Run not found"});if(!f)return e("div",{children:"Trigger not found"});const y=l.tasks_run.reduce((p,x)=>p+x.duration,0),b=l.tasks_run.map(p=>p.duration/y*100);return i(W,{header:i(T,{children:[i(w,{children:["Run #",a]}),e(le,{pipeline:u,trigger:f,run:l})]}),children:[i($,{numColsMd:3,className:"gap-6 mt-6",children:[e(on,{pipeline:u,run:l}),i(C,{children:[i(v,{className:"items-start",children:[e(m,{children:"Duration"}),e(Ee,{status:l.status})]}),e(v,{className:"justify-start items-baseline pace-x-3 truncate",children:i(be,{children:[(l.duration/1e3).toFixed(1),"s"]})}),e(ht,{categoryPercentageValues:b,colors:H,showLabels:!1,className:"mt-3"})]})]}),e("div",{className:"mt-6",children:e(C,{children:e(en,{pipeline:u,runId:a})})})]})},ln=({children:n})=>{const{isAuthenticated:t,isLoading:r}=oe(),o=mt();return!t&&!r?e(pt,{to:"/login",replace:!0,state:{from:o}}):e(T,{children:n})},dn=Object.assign({"./pages/index.tsx":Xt,"./pages/login.tsx":Bt,"./pages/pipelines/[pipelineId]/index.tsx":zt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":Jt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":cn}),un=Object.entries(dn).map(([n,t])=>{const r=n.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(o=>o.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e(ln,{children:e(t,{})}):e(t,{})}}),hn=()=>e(gt,{children:un.map(n=>e(ft,{path:n.path,element:n.element},n.path))}),mn=new yt({defaultOptions:{queries:{retry:!1}}});function pn(){return e(vt,{client:mn,children:e(xt,{children:e(_t,{children:e(hn,{})})})})}bt.createRoot(document.getElementById("root")).render(e(te.StrictMode,{children:e(pn,{})}));export{e as j};
